# 🧵 Cloth Simulator (C++ & OpenGL)

**질점-스프링(Particle–Spring) 기반 천 시뮬레이터**  
Verlet 통합으로 실시간 거동을 구현하고, 메시/텍스처/내보내기까지 다룹니다.

---

## ✅ 목표
- C++로 **수치 시뮬레이션 + 실시간 렌더링** 구조 학습  
- OpenGL 3.3 Core로 **직접 파이프라인 구성**  
- 물리 → 메시 → 텍스처 → **OBJ/MTL 익스포트**까지 확장

---

## 🔧 개발 환경
- 언어: C++
- 렌더링: OpenGL 3.3 Core / GLFW / GLAD
- 수학: GLM
- IDE: Visual Studio 2022

---

## 🗂️ 현재 구현된 기능
- Verlet 통합 기반 **질점-스프링** 시뮬레이션
- 제약(구조/전단/굽힘) 해결 및 중력 워밍업 적용
- **마우스 피킹(최근접 입자)** 및 드래그 이동 (prev 동기화로 진동 억제)
- **핀 토글(우클릭)**, 코너 히트 우선 로직, 핀 색상/상태(흰=free, 노랑=drag, 빨강=fixed)
- **메시 렌더링 + 노멀 계산**
- **텍스처 매핑**(GL_REPEAT), **타일 배율 실시간 제어**
- **OBJ/MTL/PNG 내보내기** (텍스처 자동 복사, UV 타일 반영)
- 상태 리셋 및 편의 단축키

---

## 🎮 조작법 (Controls)
- **W / A / S / D**: 카메라 이동  
- **마우스 좌클릭 드래그**: 집힌 입자 이동 (고정점 제외)  
- **마우스 우클릭**: 핀(고정) 토글  
- **Q / E**: 천(모델) 좌/우 회전  
- **R**: 천 초기화 + 회전 각도 초기화  
- **1 ~ 9**: 텍스처 타일 배율 = **1×1 ~ 9×9**  
- **K / L**: 코너 히트 반경 조절  
- **O**: 현재 화면 상태 기준 **OBJ/MTL/텍스처** 내보내기  
- **ESC**: 종료

> 참고: 과거 **[ / ] / U / F2** 등 일부 키는 현재 빌드에서 제거됨.

---

## 🖼️ 텍스처 & 타일링
- 텍스처는 `textures/` 폴더에 배치 (예: `textures/blue_camo_pattern.png`)  
- 셰이더의 `uTexScale`로 타일 반복, **1~9**로 실시간 변경  
- 내보내기 시 `uvScale`을 OBJ의 `vt`와 MTL의 `map_Kd -s`에 반영 →  
  **외부 뷰어에서도 시뮬레이터와 동일한 타일링** 재현

---

## 🤖 패턴 생성 파이프라인 (옵션)
- 콘솔에서: `venv\Scripts\python.exe gen_pattern.py`  
- 앱 내: **I**(프롬프트 모드) → **Ctrl+V**(붙여넣기) → **Enter**(생성)  
- **G**: 마지막 프롬프트 재실행 / **Shift+G**: `textures/generated.png` 리로드  
- 기본 프롬프트(비어있을 때): `seamless repeating tileable flat pattern`  
- 생성 결과 기본 경로: `textures/generated.png` (앱이 자동 로드)

---

## 📤 내보내기 (Export)
- **O 키**로 `out/cloth.obj`, `out/cloth.mtl`, `out/<texture>.png` 생성  
- MTL에는 `map_Kd -s <uvScale> <uvScale> 1 <texture.png>` 기록  
- 텍스처 파일을 **out 폴더로 자동 복사**해 뷰어 호환성 보장  
- 내보내기 시 **풀스크린 플래시 + 짧은 프리뷰 고정** 연출

---

## 🧪 앞으로 할 일 (Next)
- **시뮬 속도 안정화**: dt clamp + 서브스텝으로 프레임 변동 시 과속 방지  
- **바닥(Plane) 충돌 + S 키 정착(Settle)**  
- **핀 편집 UX**: 박스 선택/다중 토글, 핀 리스트 HUD  
- **패턴 워크플로우 강화**: 히스토리/퀵 슬롯(1–5), 미리보기 썸네일  
- (옵션) **OBJ 베이크 텍스처**: 타일 이미지를 큰 PNG로 합성 저장

